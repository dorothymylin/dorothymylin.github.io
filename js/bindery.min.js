var Bindery=function(){"use strict";function e(e,t){for(var n=[],r=0;r<e.length;r++)t(e[r])&&n.push(e[r]);return n}function t(e){return!!e}function n(){}function r(){}function i(e){this.el=e,this.styles=[]}function o(e,t){e&&(this.name=e,this.value=t||"")}function a(){var e=this;this.style=new i(this),this.classList=m(this),this.childNodes=[],this.attributes=[],this.dataset={},this.className="",this._setProperty=function(t,n,r,i){var o=e._getProperty(t,r);o?o.value=String(i):t.push("function"==typeof n?new n(r.toLowerCase(),String(i)):n)},this._getProperty=function(e,t){if(t){t=t.toLowerCase();for(var n=0;n<e.length;n++)if(t==e[n].name)return e[n]}}}function s(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function l(e){return s(e).replace(/"/g,"&quot;")}function u(){}function c(){}function d(e){e.__defineGetter__("parentNode",function(){return this.parentElement})}var p="v2.0.0-alpha.10.1",h=function(e){var t=String.prototype.split,n=/()??/.exec("")[1]===e;return function(r,i,o){if("[object RegExp]"!==Object.prototype.toString.call(i))return t.call(r,i,o);var a,s,l,u,c=[],d=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.extended?"x":"")+(i.sticky?"y":""),p=0,i=new RegExp(i.source,d+"g");for(r+="",n||(a=new RegExp("^"+i.source+"$(?!\\s)",d)),o=o===e?-1>>>0:o>>>0;(s=i.exec(r))&&!((l=s.index+s[0].length)>p&&(c.push(r.slice(p,s.index)),!n&&s.length>1&&s[0].replace(a,function(){for(var t=1;t<arguments.length-2;t++)arguments[t]===e&&(s[t]=e)}),s.length>1&&s.index<r.length&&Array.prototype.push.apply(c,s.slice(1)),u=s[0].length,p=l,c.length>=o));)i.lastIndex===s.index&&i.lastIndex++;return p===r.length?!u&&i.test("")||c.push(""):c.push(r.slice(p)),c.length>o?c.slice(0,o):c}}(),f=[].indexOf,g=function(e,t){if(f)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1},m=function(n){function r(e){var t=a();g(t,e)>-1||(t.push(e),s(t))}function i(e){var t=a(),n=g(t,e);-1!==n&&(t.splice(n,1),s(t))}function o(e){return g(a(),e)>-1}function a(){return e(n.className.split(" "),t)}function s(e){var t=e.length;n.className=e.join(" "),u.length=t;for(var r=0;r<e.length;r++)u[r]=e[r];delete e[t]}var l=n.classList;if(l)return l;var u={add:r,remove:i,contains:o,toggle:function(e){return o(e)?(i(e),!1):(r(e),!0)},toString:function(){return n.className},length:0,item:function(e){return a()[e]||null}};return u},v={className:"class",htmlFor:"for"},b={accept:new Set(["form","input"]),"accept-charset":new Set(["form"]),accesskey:"GLOBAL",action:new Set(["form"]),align:new Set(["applet","caption","col","colgroup","hr","iframe","img","table","tbody","td","tfoot","th","thead","tr"]),alt:new Set(["applet","area","img","input"]),async:new Set(["script"]),autocomplete:new Set(["form","input"]),autofocus:new Set(["button","input","keygen","select","textarea"]),autoplay:new Set(["audio","video"]),autosave:new Set(["input"]),bgcolor:new Set(["body","col","colgroup","marquee","table","tbody","tfoot","td","th","tr"]),border:new Set(["img","object","table"]),buffered:new Set(["audio","video"]),challenge:new Set(["keygen"]),charset:new Set(["meta","script"]),checked:new Set(["command","input"]),cite:new Set(["blockquote","del","ins","q"]),class:"GLOBAL",code:new Set(["applet"]),codebase:new Set(["applet"]),color:new Set(["basefont","font","hr"]),cols:new Set(["textarea"]),colspan:new Set(["td","th"]),content:new Set(["meta"]),contenteditable:"GLOBAL",contextmenu:"GLOBAL",controls:new Set(["audio","video"]),coords:new Set(["area"]),data:new Set(["object"]),datetime:new Set(["del","ins","time"]),default:new Set(["track"]),defer:new Set(["script"]),dir:"GLOBAL",dirname:new Set(["input","textarea"]),disabled:new Set(["button","command","fieldset","input","keygen","optgroup","option","select","textarea"]),download:new Set(["a","area"]),draggable:"GLOBAL",dropzone:"GLOBAL",enctype:new Set(["form"]),for:new Set(["label","output"]),form:new Set(["button","fieldset","input","keygen","label","meter","object","output","progress","select","textarea"]),formaction:new Set(["input","button"]),headers:new Set(["td","th"]),height:new Set(["canvas","embed","iframe","img","input","object","video"]),hidden:"GLOBAL",high:new Set(["meter"]),href:new Set(["a","area","base","link"]),hreflang:new Set(["a","area","link"]),"http-equiv":new Set(["meta"]),icon:new Set(["command"]),id:"GLOBAL",ismap:new Set(["img"]),itemprop:"GLOBAL",keytype:new Set(["keygen"]),kind:new Set(["track"]),label:new Set(["track"]),lang:"GLOBAL",language:new Set(["script"]),list:new Set(["input"]),loop:new Set(["audio","bgsound","marquee","video"]),low:new Set(["meter"]),manifest:new Set(["html"]),max:new Set(["input","meter","progress"]),maxlength:new Set(["input","textarea"]),media:new Set(["a","area","link","source","style"]),method:new Set(["form"]),min:new Set(["input","meter"]),multiple:new Set(["input","select"]),muted:new Set(["video"]),name:new Set(["button","form","fieldset","iframe","input","keygen","object","output","select","textarea","map","meta","param"]),novalidate:new Set(["form"]),open:new Set(["details"]),optimum:new Set(["meter"]),pattern:new Set(["input"]),ping:new Set(["a","area"]),placeholder:new Set(["input","textarea"]),poster:new Set(["video"]),preload:new Set(["audio","video"]),radiogroup:new Set(["command"]),readonly:new Set(["input","textarea"]),rel:new Set(["a","area","link"]),required:new Set(["input","select","textarea"]),reversed:new Set(["ol"]),rows:new Set(["textarea"]),rowspan:new Set(["td","th"]),sandbox:new Set(["iframe"]),scope:new Set(["th"]),scoped:new Set(["style"]),seamless:new Set(["iframe"]),selected:new Set(["option"]),shape:new Set(["a","area"]),size:new Set(["input","select"]),sizes:new Set(["img","link","source"]),span:new Set(["col","colgroup"]),spellcheck:"GLOBAL",src:new Set(["audio","embed","iframe","img","input","script","source","track","video"]),srcdoc:new Set(["iframe"]),srclang:new Set(["track"]),srcset:new Set(["img"]),start:new Set(["ol"]),step:new Set(["input"]),style:"GLOBAL",summary:new Set(["table"]),tabindex:"GLOBAL",target:new Set(["a","area","base","form"]),title:"GLOBAL",type:new Set(["button","input","command","embed","object","script","source","style","menu"]),usemap:new Set(["img","input","object"]),value:new Set(["button","option","input","li","meter","progress","param"]),width:new Set(["canvas","embed","iframe","img","input","object","video"]),wrap:new Set(["textarea"])},y={isStandardAttribute:function(e,t){t=t.toLowerCase();var n=b[e.toLowerCase()];return!!n&&("GLOBAL"===n||n.has(t))},propToAttr:function(e){return v[e]||e}};n.prototype.createTextNode=function(e){var t=new u;return t.textContent=e,t.nodeName="#text",t.nodeType=3,t},n.prototype.createElement=function(e){var t=new a;return t.nodeName=t.tagName=e,t},n.prototype.createComment=function(e){var t=new c;return t.data=e,t},u.prototype=new r,a.prototype=new r,c.prototype=new r,i.prototype.setProperty=function(e,t){this.el._setProperty(this.styles,{name:e,value:t})},i.prototype.getProperty=function(e){return this.el._getProperty(this.styles,e)},i.prototype.__defineGetter__("cssText",function(){var e="";return this.styles.forEach(function(t){e+=t.name+":"+t.value+";"}),e}),i.prototype.__defineSetter__("cssText",function(e){this.styles.length=0,e.split(";").forEach(function(e){var t=e.indexOf(":");if(t){var n=e.slice(0,t).trim(),r=e.slice(t+1).trim();this.setProperty(n,r)}},this)}),a.prototype.nodeType=1,a.prototype.appendChild=function(e){return e.parentElement=this,this.childNodes.push(e),e},a.prototype.setAttribute=function(e,t){"style"==e?this.style.cssText=t:this._setProperty(this.attributes,o,e,t)},a.prototype.getAttribute=function(e){if("style"==e)return this.style.cssText;var t=this._getProperty(this.attributes,e);return void 0!==t?t.value:null},a.prototype.removeAttribute=function(e){if("class"===e)delete this.className;else for(var t=0,n=this.attributes.length;t<n;t++)if(this.attributes[t].name===e){this.attributes.splice(t,1);break}},a.prototype.replaceChild=function(e,t){var n=this,r=!1;if(this.childNodes.forEach(function(i,o){i===t&&(n.childNodes[o]=e,e.parentElement=this,r=!0)}),r)return t},a.prototype.removeChild=function(e){var t=this,n=!0;if(this.childNodes.forEach(function(r,i){r===e&&(t.childNodes.splice(i,1),e.parentElement=null,n=!0)}),n)return e},a.prototype.insertBefore=function(e,t){var n=this.childNodes;if(null===t)n.push(e);else for(var r=0,i=n.length;r<i;r++)if(n[r]===t){0===r?n.unshift(e):n.splice(r,0,e);break}return e.parentElement=this,e},a.prototype.addEventListener=function(e,t,n,r){},a.prototype.removeEventListener=function(e,t,n){},a.prototype.insertAdjacentHTML=function(e,t){},a.prototype.__defineGetter__("innerHTML",function(){var e=this.childNodes.html||"";return this.childNodes.forEach(function(t){e+=t.outerHTML||t.textContent}),e}),a.prototype.__defineSetter__("innerHTML",function(e){this.childNodes.length=0,this.childNodes.html=e}),a.prototype.__defineGetter__("outerHTML",function(){function e(e){var t,n=[];return e.forEach(function(e){t="style"!=e.name?e.value:r.style.cssText,n.push(e.name+'="'+l(t)+'"')}),n.length?" "+n.join(" "):""}function t(e,t){return!r.getAttribute(t)&&!("className"===e&&!r[e])}var n=[],r=this,i={AREA:!0,BASE:!0,BR:!0,COL:!0,EMBED:!0,HR:!0,IMG:!0,INPUT:!0,KEYGEN:!0,LINK:!0,META:!0,PARAM:!0,SOURCE:!0,TRACK:!0,WBR:!0},o=this.style.cssText?this.attributes.concat([{name:"style"}]):this.attributes;return n.push("<"+this.nodeName+function(){var n=[];for(var i in r){var o=y.propToAttr(i);r.hasOwnProperty(i)&&-1!==["string","boolean","number"].indexOf(typeof r[i])&&y.isStandardAttribute(o,r.nodeName)&&t(i,o)&&n.push({name:o,value:r[i]})}return n?e(n):""}()+e(o)+function(e){var t=[];return Object.keys(e).forEach(function(n){t.push("data-"+n+'="'+l(e[n])+'"')}),t.length?" "+t.join(" "):""}(this.dataset)+">"),i[this.nodeName.toUpperCase()]||(n.push(this.innerHTML),n.push("</"+this.nodeName+">")),n.join("")}),a.prototype.__defineGetter__("textContent",function(){var e="";return this.childNodes.forEach(function(t){e+=t.textContent}),e}),a.prototype.__defineSetter__("textContent",function(e){var t=new u;return t.textContent=e,this.childNodes=[t],e}),a.prototype.addEventListener=function(e,t){},a.prototype.nodeValue=null,u.prototype.nodeType=3,u.prototype.nodeName="#text",u.prototype.__defineGetter__("textContent",function(){return s(this.value||"")}),u.prototype.__defineSetter__("textContent",function(e){this.value=e}),u.prototype.__defineGetter__("nodeValue",function(){return s(this.value||"")}),u.prototype.__defineSetter__("nodeValue",function(e){this.value=e}),u.prototype.__defineGetter__("length",function(){return(this.value||"").length}),u.prototype.replaceData=function(e,t,n){this.value=this.value.slice(0,e)+n+this.value.slice(e+t)},c.prototype.nodeType=8,c.prototype.nodeName="#comment",c.prototype.__defineGetter__("data",function(){return this.value}),c.prototype.__defineSetter__("data",function(e){this.value=e}),c.prototype.__defineGetter__("outerHTML",function(){return"\x3c!--"+s(this.value||"")+"--\x3e"}),c.prototype.__defineGetter__("nodeValue",function(){return s(this.value||"")}),c.prototype.__defineSetter__("nodeValue",function(e){this.value=e}),d(a.prototype),d(c.prototype),d(u.prototype),d(r.prototype);var w={Document:n,Node:r,Element:a,Comment:c,Text:u,document:new n},k=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){function t(){function e(){function e(o){var u;if(null==o);else if("string"==typeof o)l?l.appendChild(u=a.createTextNode(o)):function(e){var t=h(e,/([\.#]?[^\s#.]+)/);/^\.|#/.test(t[1])&&(l=a.createElement("div")),r(t,function(e){var t=e.substring(1,e.length);e&&(l?"."===e[0]?m(l).add(t):"#"===e[0]&&l.setAttribute("id",t):l=a.createElement(e))})}(o);else if("number"==typeof o||"boolean"==typeof o||o instanceof Date||o instanceof RegExp)l.appendChild(u=a.createTextNode(o.toString()));else if(i(o))r(o,e);else if(n(o))l.appendChild(u=o);else if(o instanceof s)l.appendChild(u=o);else if("object"==typeof o)for(var c in o)if("function"==typeof o[c])/^on\w+/.test(c)?function(e,n){l.addEventListener?(l.addEventListener(e.substring(2),n[e],!1),t.push(function(){l.removeEventListener(e.substring(2),n[e],!1)})):(l.attachEvent(e,n[e]),t.push(function(){l.detachEvent(e,n[e])}))}(c,o):(l[c]=o[c](),t.push(o[c](function(e){l[c]=e})));else if("style"===c)if("string"==typeof o[c])l.style.cssText=o[c];else for(var d in o[c])!function(e,n){if("function"==typeof n)l.style.setProperty(e,n()),t.push(n(function(t){l.style.setProperty(e,t)}));else var r=o[c][e].match(/(.*)\W+!important\W*$/);r?l.style.setProperty(e,r[1],"important"):l.style.setProperty(e,o[c][e])}(d,o[c][d]);else if("attrs"===c)for(var p in o[c])l.setAttribute(p,o[c][p]);else"data-"===c.substr(0,5)?l.setAttribute(c,o[c]):l[c]=o[c];else if("function"==typeof o){p=o();l.appendChild(u=n(p)?p:a.createTextNode(p)),t.push(o(function(e){n(e)&&u.parentElement?(u.parentElement.replaceChild(e,u),u=e):u.textContent=e}))}return u}for(var o=[].slice.call(arguments),l=null;o.length;)e(o.shift());return l}var t=[];return e.cleanup=function(){for(var e=0;e<t.length;e++)t[e]();t.length=0},e}function n(e){return e&&e.nodeName&&e.nodeType}function r(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n++)t(e[n],n)}function i(e){return"[object Array]"==Object.prototype.toString.call(e)}var o="undefined"==typeof window?w:window,a=o.document,s=o.Text;(e.exports=t()).context=t}),x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},C=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},P=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},L=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},E=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},z=function(){function e(){S(this,e),this.pages=[],this.queued=[],this.isComplete=!1,this.estimatedProgress=0}return C(e,[{key:"pagesForSelector",value:function(e){return this.pagesForTest(function(t){return t.element.querySelector(e)})}},{key:"pagesForTest",value:function(e){return this.pages.filter(function(t){return e(t.element)}).map(function(e){return e.number})}},{key:"onComplete",value:function(e){this.isComplete?e():this.queued.push(e)}},{key:"setCompleted",value:function(){this.isComplete=!0,this.estimatedProgress=1,this.queued.forEach(function(e){e()}),this.queued=[]}},{key:"pageCount",get:function(){return this.pages.length}}]),e}(),A=function(e){return e[e.length-1]},T=function(e){var t="",n=e[0],r=!1;return e.forEach(function(i,o){var a=o===e.length-1,s=i===n+1;0===o?t+=""+i:a?t+=s?"–"+i:r?"–"+n+", "+i:", "+i:s?r=!0:r&&!s?(r=!1,t+="–"+n+", "+i):t+=", "+i,n=i}),t},O=/^([+-]?[0-9]+(.?[0-9]+)?)(px|in|cm|mm|pt|pc)$/,B=function(e){return O.test(e)},N=function(e){Object.keys(e).forEach(function(t){if(!B(e[t]))throw"number"==typeof e[t]?Error("Size is missing units { "+t+": "+e[t]+" }"):Error("Invalid size { "+t+": "+e[t]+" }")})},R=function(e){var t=e.match(O);return{val:Number(t[1]),unit:t[3]}},M=function(e,t){var n=!0;return Object.keys(e).forEach(function(r){if(t[r]){var i=e[r],o=t[r];o(i)||(console.error("Bindery: For property '"+t.name+"."+r+"', "+JSON.stringify(i)+" is not a valid value of type "+o.name),n=!1)}else console.error("Bindery: '"+t.name+"' doesn't have property '"+r+"'"),n=!1}),n},j=function(e){return"object"===(void 0===e?"undefined":x(e))},F={enum:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=function(e){return t.includes(e)};return Object.defineProperty(r,"name",{writable:!0}),r.name="enum ( '"+t.join("' | '")+"' )",r},any:function(){return!0},string:function(e){return"string"==typeof e},length:B,bool:function(e){return"boolean"==typeof e},func:function(e){return"function"==typeof e},obj:j,array:function(e){return Array.isArray(e)},shape:function(e){return function(t){return j(t)&&M(t,e)}},validate:M},I=function(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n+=1){var r=t[n].split("=");if(r[0]===e)return r[1]}return!1},H=function(e){return"📖-"+e},D=function(e){return"."+H(e)},G=function(e){return"."===e[0]?D(e.substr(1)):H(e)},q=function(){function e(){S(this,e),this.flowContent=k(G(".content")),this.flowBox=k(G(".flowbox"),this.flowContent),this.footer=k(G(".footer")),this.background=k(G(".background")),this.element=k(G(".page")+G(".page-size"),this.background,this.flowBox,this.footer)}return C(e,[{key:"overflowAmount",value:function(){var e=this.flowContent.offsetHeight,t=this.flowBox.offsetHeight;if(0===t)throw Error("Bindery: Trying to flow into a box of zero height.");return e-t}},{key:"hasOverflowed",value:function(){return this.overflowAmount()>-5}},{key:"setLeftRight",value:function(e){if("left"===e)this.side=e,this.element.classList.remove(G("right")),this.element.classList.add(G("left"));else{if("right"!==e)throw Error("Bindery: Setting page to invalid direction"+e);this.side=e,this.element.classList.remove(G("left")),this.element.classList.add(G("right"))}}},{key:"setPreference",value:function(e){"left"===e&&(this.alwaysLeft=!0),"right"===e&&(this.alwaysRight=!0)}},{key:"suppressErrors",get:function(){return this.suppress||!1},set:function(e){this.suppress=e,e?this.element.classList.add(G("is-overflowing")):this.element.classList.remove(G("is-overflowing"))}},{key:"isEmpty",get:function(){return!this.hasOutOfFlowContent&&""===this.flowContent.textContent.trim()&&this.flowContent.offsetHeight<1}},{key:"isLeft",get:function(){return"left"===this.side}},{key:"isRight",get:function(){return"right"===this.side}}],[{key:"isSizeValid",value:function(){document.body.classList.remove(G("viewing"));var t=new e,n=document.querySelector(G(".measure-area"));n||(n=document.body.appendChild(k(G(".measure-area")))),n.innerHTML="",n.appendChild(t.element);var r=t.flowBox.getBoundingClientRect();return n.parentNode.removeChild(n),r.height>100&&r.width>100}}]),e}(),V=function e(t){return!!t.hasAttribute("data-ignore-overflow")||!!t.parentElement&&e(t.parentElement)},U=new(function(){function e(){S(this,e),this.numberOfCalls=0,this.resumeLimit=1/0,this.callsSinceResume=0,this.queuedFunc=null,this.isPaused=!1,this.useDelay=!1,this.delayTime=100,this.lastWaitedTime=0}return C(e,[{key:"throttle",value:function(e){var t=this;this.callsSinceResume+=1,this.callsSinceResume>this.resumeLimit&&this.endResume();var n=performance.now()-this.lastWaitedTime;this.isPaused?this.queuedFunc=e:this.useDelay?setTimeout(e,this.delayTime):this.numberOfCalls<800&&n<50?(this.numberOfCalls+=1,e()):(this.numberOfCalls=0,document.hidden?setTimeout(e,1):requestAnimationFrame(function(n){t.lastWaitedTime=n,e()}))}},{key:"pause",value:function(){return this.isPaused?"Already paused":(this.isPaused=!0,"Paused")}},{key:"resumeDelay",value:function(){this.useDelay=!0,this.resume()}},{key:"finish",value:function(){this.useDelay=!1,this.resume()}},{key:"resume",value:function(){return this.isPaused?(this.isPaused=!1,this.queuedFunc?(this.queuedFunc(),this.queuedFunc=null,"Resuming"):"Layout complete"):"Already running"}},{key:"step",value:function(){if(!this.isPaused)return this.pause();if(this.queuedFunc){var e=this.queuedFunc,t=e.name;return this.queuedFunc=null,e(),t}return"Layout complete"}},{key:"resumeFor",value:function(e){return this.callsSinceResume=0,this.resumeLimit=e,this.resume()}},{key:"endResume",value:function(){console.log("Paused after "+this.resumeLimit),this.resumeLimit=1/0,this.callsSinceResume=0,this.pause()}},{key:"isDebugging",get:function(){return this.useDelay},set:function(e){this.useDelay=e,e&&(window.binderyDebug={pause:this.pause.bind(this),resume:this.resume.bind(this),resumeFor:this.resumeFor.bind(this),step:this.step.bind(this),finish:this.finish.bind(this)},console.log("Bindery: Debug layout with the following: \nbinderyDebug.pause() \nbinderyDebug.resume()\n binderyDebug.resumeFor(n) // pauses after n steps, \nbinderyDebug.step()"))}}]),e}()),W=function(){function e(t){S(this,e),this.successArgs=[],this.errorArgs=[],this.successCallback=null,this.errorCallback=null,this.progressCallback=null,this.chainedThenable=null,this.chainedSuccessCallback=null,this.chainedErrorCallback=null,this.isRejected=!1,this.isResolved=!1,this.resolve=this.resolve.bind(this),this.reject=this.reject.bind(this),this.updateProgress=this.updateProgress.bind(this),t&&t(this.resolve,this.reject,this.updateProgress)}return C(e,[{key:"then",value:function(e){if(this.chainedThenable)return this.chainedThenable.then(e);if(!this.successCallback)return this.successCallback=e,this.isResolved&&this.resolve(),this;if(!this.chainedSuccessCallback)return this.chainedSuccessCallback=e,this.isResolved&&this.resolveChained(),this;throw Error("need real chained then")}},{key:"progress",value:function(e){return this.progressCallback=e,this}},{key:"catch",value:function(e){if(this.chainedThenable)return this.chainedThenable.catch(e);if(!this.errorCallback)return this.errorCallback=e,this.isRejected&&this.reject(),this;if(!this.chainedErrorCallback)return this.chainedErrorCallback=e,this.isRejected&&this.rejectChained(),this;throw Error("need real chained catch")}},{key:"resolve",value:function(){this.isResolved=!0;for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length>0&&(this.successArgs=t),null!==this.successCallback){var r=void 0;(r=this.successArgs.length>0?this.successCallback.apply(this,E(this.successArgs)):this.successCallback())&&r.then&&(this.chainedThenable=r),this.chainedSuccessCallback&&this.resolveChained()}}},{key:"resolveChained",value:function(){this.chainedThenable?this.chainedThenable.then(this.chainedSuccessCallback):this.chainedSuccessCallback()}},{key:"reject",value:function(){this.isRejected=!0;for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length>0&&(this.errorArgs=t),null!==this.errorCallback){var r=void 0;(r=this.errorArgs.length>0?this.errorCallback.apply(this,E(this.errorArgs)):this.errorCallback())&&r.then&&(this.chainedThenable=r),this.successCallback&&r&&r.then&&r.then(this.successCallback),this.chainedSuccessCallback&&(r&&r.then?r.then(this.chainedSuccessCallback):this.chainedSuccessCallback()),this.chainedErrorCallback&&this.rejectChained()}}},{key:"rejectChained",value:function(){this.chainedThenable?this.chainedThenable.catch(this.chainedErrorCallback):this.chainedErrorCallback()}},{key:"updateProgress",value:function(){null!==this.progressCallback&&this.progressCallback.apply(this,arguments)}}],[{key:"resolved",value:function(){return new e(function(e){return e()})}}]),e}(),Y=function(e,t,n){return new W(function(r,i){t.appendChild(e),n.hasOverflowed()?(t.removeChild(e),U.throttle(i)):U.throttle(r)})},Z=function(e,t,n){return new W(function(r,i){var o=e.nodeValue;if(t.appendChild(e),n.hasOverflowed()&&!V(t)){var a=0;!function t(){if(e.nodeValue=o.substr(0,a),n.hasOverflowed()){for(" "===o.charAt(a)&&(a-=1);" "!==o.charAt(a)&&a>0;)a-=1;if(a<1)return e.nodeValue=o,e.parentNode.removeChild(e),void U.throttle(i);var s=o.substr(0,a),l=o.substr(a);e.nodeValue=s;var u=document.createTextNode(l);U.throttle(function(){return r(u)})}else if(a>o.length-1)U.throttle(r);else{for(a+=1;" "!==o.charAt(a)&&a<o.length;)a+=1;U.throttle(t)}}()}else U.throttle(r)})},K=function e(t){var n=this;S(this,e),this.name=t.name?t.name:"Unnamed Bindery Rule",this.selector="",Object.keys(t).forEach(function(e){n[e]=t[e]})},J=function(e){function t(e){S(this,t);var n=L(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name="Out of Flow",n}return P(t,K),C(t,[{key:"beforeAdd",value:function(e){return e.setAttribute("data-ignore-overflow",!0),e}},{key:"afterAdd",value:function(e,t,n,r){return this.createOutOfFlowPages(e,t,r),("same"!==this.continue||t.pageInProgress.hasOutOfFlowContent)&&(n(!0),"left"!==this.continue&&"right"!==this.continue||t.pageInProgress.setPreference(this.continue)),e}}]),t}(),$=function(e){function t(e){S(this,t),e.continue=e.continue||"same",e.rotate=e.rotate||"none";var n=L(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return F.validate(e,{name:"FullBleedPage",selector:F.string,continue:F.enum("next","same","left","right"),rotate:F.enum("none","inward","outward","clockwise","counterclockwise")}),n}return P(t,J),C(t,[{key:"createOutOfFlowPages",value:function(e,t,n){e.parentNode.removeChild(e);var r=void 0;if(t.pageInProgress.isEmpty?r=t.pageInProgress:(r=n(),t.pages.push(r)),"none"!==this.rotate){var i=k(G(".rotate-container"));i.classList.add(G("page-size-rotated")),i.classList.add(G("rotate-"+this.rotate)),i.appendChild(r.background),r.element.appendChild(i)}r.background.appendChild(e),r.hasOutOfFlowContent=!0}}]),t}(),X=function(e){function t(e){S(this,t),e.continue=e.continue||"same",e.rotate=e.rotate||"none";var n=L(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return F.validate(e,{name:"FullBleedSpread",selector:F.string,continue:F.enum("next","same","left","right"),rotate:F.enum("none","clockwise","counterclockwise")}),n}return P(t,J),C(t,[{key:"createOutOfFlowPages",value:function(e,t,n){var r=this;e.parentNode.removeChild(e);var i=void 0;t.pageInProgress.isEmpty?i=t.pageInProgress:(i=n(),t.pages.push(i));var o=n();t.pages.push(o),"none"!==this.rotate&&[i,o].forEach(function(e){var t=k(G(".rotate-container"));t.classList.add(G("spread-size-rotated")),t.classList.add(G("rotate-spread-"+r.rotate)),t.appendChild(e.background),e.element.appendChild(t)}),i.background.appendChild(e),i.element.classList.add(G("spread")),i.setPreference("left"),i.isOutOfFlow="same"===this.continue,i.hasOutOfFlowContent=!0,o.background.appendChild(e.cloneNode(!0)),o.element.classList.add(G("spread")),o.setPreference("right"),o.isOutOfFlow="same"===this.continue,o.hasOutOfFlowContent=!0}}]),t}(),Q=function(e){function t(e){S(this,t),e.position=e.position||"before",e.continue=e.continue||"next";var n=L(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return F.validate(e,{name:"PageBreak",selector:F.string,continue:F.enum("next","left","right"),position:F.enum("before","after","both","avoid")}),n}return P(t,K),C(t,[{key:"beforeAdd",value:function(e,t,n){return"before"!==this.position&&"both"!==this.position||(t.pageInProgress.isEmpty||n(),"next"!==this.continue&&t.pageInProgress.setPreference(this.continue)),e}},{key:"afterAdd",value:function(e,t,n){if("after"===this.position||"both"===this.position){var r=n(!0);"next"!==this.continue&&r.setPreference(this.continue)}return e}},{key:"avoidSplit",get:function(){return"avoid"===this.position}}]),t}(),ee=function(e){var t=e.tagName.toLowerCase(),n=e.id?"#"+e.id:"",r="";e.classList.length>0&&(r="."+[].concat(E(e.classList)).join("."));var i="";return n.length<1&&r.length<2&&(i='("'+e.textContent.substr(0,30).replace(/\s+/g," ")+'...")'),t+n+r+i},te=function(e){return e instanceof X||e instanceof $||e instanceof Q},ne=function(e){var t=e.filter(te),n=e.filter(function(e){return!t.includes(e)}),r=t.find(function(e){return e instanceof X}),i=t.find(function(e){return e instanceof $});return r?n.push(r):i?n.push(i):n.push.apply(n,E(t)),n},re=function(){function e(t){S(this,e),this.rules=t,this.pageRules=t.filter(function(e){return e.eachPage}),this.beforeAddRules=t.filter(function(e){return e.selector&&e.beforeAdd}),this.afterAddRules=t.filter(function(e){return e.selector&&e.afterAdd}),this.selectorsNotToSplit=t.filter(function(e){return e.avoidSplit}).map(function(e){return e.selector})}return C(e,[{key:"setup",value:function(){this.rules.forEach(function(e){e.setup&&e.setup()})}},{key:"startPage",value:function(e,t){this.rules.forEach(function(n){n.afterPageCreated&&n.afterPageCreated(e,t)})}},{key:"finishEveryPage",value:function(e){this.pageRules.forEach(function(t){e.pages.forEach(function(n){t.eachPage(n,e)})})}},{key:"finishPage",value:function(e,t){this.pageRules.forEach(function(n){n.eachPage(e,t)})}},{key:"beforeAddElement",value:function(e,t,n,r){var i=e;return this.beforeAddRules.filter(function(e){return i.matches(e.selector)}).forEach(function(e){i=e.beforeAdd(i,t,n,r)}),i}},{key:"afterAddElement",value:function(e,t,n,r,i){var o=e,a=this.afterAddRules.filter(function(e){return o.matches(e.selector)});return ne(a).forEach(function(e){o=e.afterAdd(o,t,n,r,function(o){return i(o),e.afterAdd(o,t,n,r,function(){console.log("Couldn't apply "+e.name+" to "+ee(o)+". Caused overflows twice.")})})}),o}}]),e}(),ie=function(e,t){for(var n=t;n<e.length;n+=1)if(!e[n].isOutOfFlow)return n;return t},oe=function(e,t){for(var n=e.slice(),r=0;r<n.length;r+=1){var i=n[r],o=r%2!=0;if(o&&i.alwaysRight||!o&&i.alwaysLeft)if(i.isOutOfFlow){var a=ie(n,r+1),s=n[a];n.splice(a,1),n.splice(r,0,s)}else n.splice(r,0,t())}return n},ae=function(e){e.forEach(function(e,t){e.number=t+1,e.setLeftRight(t%2==0?"right":"left")});var t={h1:"",h2:"",h3:"",h4:"",h5:"",h6:""};e.forEach(function(e){e.heading={},Object.keys(t).forEach(function(n,r){var i=e.element.querySelector(n);i&&(t[n]=i.textContent,Object.keys(t).forEach(function(e,n){n>r&&(t[e]="")})),""!==t[n]&&(e.heading[n]=t[n])})})},se=function(e,t){for(var n=[],r=t.filter(function(e){return e.customToNextClass}).map(function(e){return e.customToNextClass}),i=t.filter(function(e){return e.customFromPreviousClass}).map(function(e){return e.customFromPreviousClass}),o=e.length-1;o>=0;o-=1){var a=e[o],s=a.cloneNode(!1);if(s.innerHTML="",function(e){e.classList.add(G("continues")),r.forEach(function(t){return e.classList.add(t)})}(a),function(e){e.classList.add(G("continuation")),i.forEach(function(t){return e.classList.add(t)})}(s),"OL"===s.tagName){var l=1;a.hasAttribute("start")&&(l=parseInt(a.getAttribute("start"),10)),o<e.length-1&&"LI"===e[o+1].tagName&&(l-=1);var u=l+a.children.length;s.setAttribute("start",u)}o<e.length-1&&s.appendChild(n[o+1]),n[o]=s}return n},le=function(e){return new W(function(t){var n=setInterval(function(){e.naturalWidth&&(clearInterval(n),t())},10);e.addEventListener("error",function(){clearInterval(n),t()}),e.src=e.src})},ue=function(e){return e.nodeType===Node.TEXT_NODE},ce=function(e){return e.nodeType===Node.ELEMENT_NODE},de=function(e){return"SCRIPT"===e.tagName},pe=function(e){return"IMG"===e.tagName},he=function(e){return pe(e)&&!e.naturalWidth},fe=function(e){return ce(e)&&!de(e)},ge=function(e){return(e/1e3).toFixed(2)},me=function e(t,n){return n.some(function(e){return t.matches(e)})?!(!t.hasAttribute("data-bindery-did-move")&&!t.classList.contains(G("continuation"))):!t.parentElement||e(t.parentElement,n)},ve=function(e,t){return new W(function(n,r,i){var o=0,a=0,s=0,l=new re(t),u=document.body.appendChild(k(G(".measure-area"))),c=[],d=new z,p=function(){return!V(A(c))},h=function(){var e=new q;return u.appendChild(e.element),l.startPage(e,d),e},f=function(e,t){if(e&&e.hasOverflowed()&&(console.warn("Bindery: Page overflowing",d.pageInProgress.element),!e.suppressErrors&&!t))throw r("Moved to new page when last one is still overflowing"),Error("Bindery: Moved to new page when last one is still overflowing");d.pages=oe(d.pages,h),ae(d.pages),e&&l.finishPage(e,d)},g=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(d.pages.length>2e3)throw r("Maximum page count exceeded"),Error("Bindery: Maximum page count exceeded. Suspected runaway layout.");f(d.pageInProgress,e),c=se(c,t);var n=h();if(d.pageInProgress=n,i(d),d.pages.push(n),c[0]&&n.flowContent.appendChild(c[0]),n.hasOverflowed()){var o=A(c);o?(console.warn("Bindery: Content overflows, probably due to a style set on "+ee(o)+"."),o.parentNode.removeChild(o)):console.warn("Bindery: Content overflows.")}return n},m=function(e){if(c.pop(),c.length<1)throw Error("Bindery: Attempting to move the top-level element");for(var t=e,n=[];c.length>1&&!me(A(c),l.selectorsNotToSplit);)t=c.pop(),n.unshift(t);t.setAttribute("data-bindery-did-move",!0);var r=t.parentNode;r.removeChild(t),c.length>1&&""===A(c).textContent.trim()&&(r.appendChild(t),t=c.pop(),n.unshift(t),t.parentNode.removeChild(t)),d.pageInProgress.isEmpty||(d.pageInProgress.hasOverflowed()&&(d.pageInProgress.suppressErrors=!0),g()),A(c).appendChild(t),n.forEach(function(e){c.push(e)}),c.push(e)},v=function(e,t){return new W(function(n){t.appendChild(e),p()&&(d.pageInProgress.suppressErrors=!0,g()),n()})},b=function e(t){return new W(function(n,r){Z(t,A(c),d.pageInProgress).then(function(t){t?(g(),e(t).then(n).catch(r)):n()}).catch(r)})},y=function(e){return me(e,l.selectorsNotToSplit)&&!V(e)},w=function(e,t){return(y(t)?b(e).catch(function(){return c.length<2?v(e,A(c)):(m(t),b(e))}):Y(e,A(c),d.pageInProgress).catch(function(){return p()&&m(t),Y(e,A(c),d.pageInProgress)})).catch(function(){return v(e,A(c))})},x=void 0,S=function(e,t){if(ue(e))return w(e,t);if(he(e)){var n=performance.now();return le(e).then(function(){return o+=performance.now()-n,x(e)})}return fe(e)?x(e):W.resolved()};x=function(e){return new W(function(t){d.pageInProgress.hasOverflowed()&&p()&&(d.pageInProgress.suppressErrors=!0,g());var n=l.beforeAddElement(e,d,g,h);c[0]?A(c).appendChild(n):d.pageInProgress.flowContent.appendChild(n),c.push(n);var r=[].concat(E(n.childNodes));n.innerHTML="",d.pageInProgress.hasOverflowed()&&p()&&m(n);var i=function(){var e=c.pop();l.afterAddElement(e,d,g,h,function(e){e.parentNode.removeChild(e),g(),A(c).appendChild(e)}),s+=1,d.estimatedProgress=s/a,t()},o=0;!function e(){if(o<r.length){var t=r[o];o+=1,S(t,n).then(e)}else i()}()})},function(){var t=window.performance.now();l.setup(),e.style.margin=0,e.style.padding=0,a=e.querySelectorAll("*").length,g(),x(e).then(function(){document.body.removeChild(u),d.pages=oe(d.pages,h),ae(d.pages),d.setCompleted(),l.finishEveryPage(d);var e=window.performance.now()-t,r=e-o;console.log("📖 Book ready in "+ge(e)+"s (Layout: "+ge(r)+"s, Waiting for images: "+ge(o)+"s)"),n(d)})}()})},be={width:"8.5in",height:"11in"},ye={width:"210mm",height:"297mm"},we={bleed:"12pt",size:{width:"4in",height:"6in"},margin:{inner:"24pt",outer:"24pt",bottom:"40pt",top:"48pt"}},ke=!!window.chrome&&!!window.chrome.webstore,xe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};S(this,e),this.setSize(t.size||we.size),this.setMargin(t.margin||we.margin),this.setBleed(t.bleed||we.bleed),this.printTwoUp=!1,this.sheetSizeMode=ke?"size_page":"size_page_marks"}return C(e,[{key:"setSize",value:function(e){N(e),this.size=e}},{key:"setMargin",value:function(e){N(e),this.margin=e}},{key:"setBleed",value:function(e){this.bleed=e}},{key:"setSheetSizeMode",value:function(e){this.sheetSizeMode=e}},{key:"setPrintTwoUp",value:function(e){this.printTwoUp=e}},{key:"isSizeValid",value:function(){return this.updateStylesheet(),q.isSizeValid()}},{key:"spreadSizeStyle",value:function(){var e=R(this.size.width);return{height:this.size.height,width:""+2*e.val+e.unit}}},{key:"updateStylesheet",value:function(){var e=void 0,t=document.querySelector("#binderyPageSetup");t?e=t:(e=document.createElement("style")).id="binderyPageSetup";var n=R(this.size.width);e.innerHTML="\n@page { size: "+this.sheetSize.width+" "+this.sheetSize.height+"; }\n"+G(".print-page")+" { width: "+this.sheetSize.width+"; height: "+this.sheetSize.height+";}\n\n"+G(".show-crop")+" "+G(".print-page")+" "+G(".spread-wrapper")+",\n"+G(".show-bleed-marks")+" "+G(".print-page")+" "+G(".spread-wrapper")+" {\n  margin: calc("+this.bleed+" + 12pt) auto;\n}\n"+G(".page-size")+" {\n  height: "+this.size.height+";\n  width: "+this.size.width+";\n}\n"+G(".page-size-rotated")+" {\n  height: "+this.size.width+";\n  width: "+this.size.height+";\n}\n"+G(".spread-size")+" {\n  height: "+this.size.height+";\n  width: "+2*n.val+n.unit+";\n}\n"+G(".spread-size-rotated")+" {\n  height: "+2*n.val+n.unit+";\n  width: "+this.size.height+";\n}\n"+G(".flowbox")+",\n"+G(".footer")+" {\n  margin-left: "+this.margin.inner+";\n  margin-right: "+this.margin.outer+";\n}\n"+G(".left")+" "+G(".flowbox")+",\n"+G(".left")+" "+G(".footer")+" {\n  margin-left: "+this.margin.outer+";\n  margin-right: "+this.margin.inner+";\n}\n\n"+G(".left")+" "+G(".running-header")+" {\n  left: "+this.margin.outer+";\n}\n"+G(".right")+" "+G(".running-header")+" {\n  right: "+this.margin.outer+";\n}\n\n"+G(".flowbox")+" { margin-top: "+this.margin.top+"; }\n"+G(".footer")+"{ margin-bottom: "+this.margin.bottom+"; }\n\n"+G(".bleed-left")+",\n"+G(".bleed-right")+",\n"+G(".crop-left")+",\n"+G(".crop-right")+",\n"+G(".crop-fold")+" {\n  top: calc( -12pt - "+this.bleed+" );\n  bottom: calc( -12pt - "+this.bleed+" );\n}\n\n"+G(".bleed-top")+",\n"+G(".bleed-bottom")+",\n"+G(".crop-top")+",\n"+G(".crop-bottom")+" {\n  left: calc( -12pt - "+this.bleed+" );\n  right: calc( -12pt - "+this.bleed+" );\n}\n"+G(".bleed-left")+"   { left: -"+this.bleed+"; }\n"+G(".bleed-right")+"  { right: -"+this.bleed+"; }\n"+G(".bleed-top")+"    { top: -"+this.bleed+"; }\n"+G(".bleed-bottom")+" { bottom: -"+this.bleed+"; }\n\n"+G(".background")+" {\n  top: -"+this.bleed+";\n  bottom: -"+this.bleed+";\n  left: -"+this.bleed+";\n  right: -"+this.bleed+";\n}\n\n"+G(".spread")+G(".right")+" > "+G(".background")+" {\n  left: calc(-100% - "+this.bleed+");\n}\n"+G(".spread")+G(".left")+" > "+G(".background")+" {\n  right: calc(-100% - "+this.bleed+");\n}\n    ",document.head.appendChild(e)}},{key:"displaySize",get:function(){return{width:this.printTwoUp?this.spreadSizeStyle().width:this.size.width,height:this.size.height,bleed:this.bleed}}},{key:"sheetSize",get:function(){var e=this.printTwoUp?this.spreadSizeStyle().width:this.size.width,t=this.size.height,n=this.bleed;switch(this.sheetSizeMode){case"size_page":return{width:e,height:t};case"size_page_bleed":return{width:"calc("+e+" + "+n+" + "+n+")",height:"calc("+t+" + "+n+" + "+n+")"};case"size_page_marks":return{width:"calc("+e+" + "+n+" + "+n+" + 24pt)",height:"calc("+t+" + "+n+" + "+n+" + 24pt)"};case"size_letter_l":return{width:be.height,height:be.width};case"size_letter_p":return be;case"size_a4_p":return ye;case"size_a4_l":return{width:ye.height,height:ye.width}}return{width:e,height:t}}}]),e}(),Se=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,[G(".title")].concat(t))},Ce=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,[G(".row")].concat(t))},_e=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,["button"+G(".control")+G(".btn")].concat(t))},Pe=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,["button"+G(".control")+G(".btn")+G(".btn-main")].concat(t))},Le=function(){for(var e=k(G(".select-val"),"Value"),t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=k.apply(void 0,["select."+G("select")].concat(n)),o=function(){e.textContent=i.options[i.selectedIndex].text};return i.addEventListener("change",o),o(),k(""+G(".select-wrap")+G(".control"),e,i)},Ee=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,["option"].concat(t))},ze=!!window.chrome&&!!window.chrome.webstore,Ae=function e(t){var n=this;S(this,e),this.binder=t.binder;var r=t.viewer,i=void 0,o=void 0,a=void 0,s=Pe({onclick:function(){r.setPrint();var e=i.querySelector("select");e.value="view_print",e.dispatchEvent(new Event("change")),setTimeout(window.print,10)}},"Print"),l=ze?[Ee({value:"size_page",selected:!0},"Auto"),Ee({value:"size_page_bleed"},"Auto + Bleed"),Ee({value:"size_page_marks"},"Auto + Marks"),Ee({value:"size_letter_p"},"Letter Portrait"),Ee({value:"size_letter_l"},"Letter Landscape"),Ee({value:"size_a4_p"},"A4 Portrait"),Ee({value:"size_a4_l"},"A4 Landscape")]:[Ee({value:"size_letter_p",selected:!0},"Default Page Size *"),Ee({disabled:!0},"Only Chrome supports custom page sizes. Set in your browser's print dialog instead.")],u=function(){if(ze){var e=n.binder.pageSetup.displaySize,t=e.width+" × "+e.height;l[0].textContent=""+t,l[1].textContent=t+" + Bleed",l[2].textContent=t+" + Marks"}};u();var c=Le.apply(void 0,[{onchange:function(e){var t=e.target.value;r.setSheetSize(t),"size_page"===t||"size_page_bleed"===t?o.classList.add(G("hidden-select")):o.classList.remove(G("hidden-select")),n.binder.pageSetup.updateStylesheet()}}].concat(l)),d=Le({onchange:function(e){r.setPrintArrange(e.target.value),u()}},Ee({value:"arrange_one",selected:!0},"1 Page / Sheet"),Ee({value:"arrange_two"},"1 Spread / Sheet"),Ee({value:"arrange_booklet"},"Booklet Sheets")),p=Ce(d);o=Le({onchange:function(e){switch(e.target.value){case"marks_none":r.isShowingCropMarks=!1,r.isShowingBleedMarks=!1;break;case"marks_crop":r.isShowingCropMarks=!0,r.isShowingBleedMarks=!1;break;case"marks_bleed":r.isShowingCropMarks=!1,r.isShowingBleedMarks=!0;break;case"marks_both":r.isShowingCropMarks=!0,r.isShowingBleedMarks=!0}}},Ee({value:"marks_none"},"No Marks"),Ee({value:"marks_crop",selected:!0},"Crop Marks"),Ee({value:"marks_bleed"},"Bleed Marks"),Ee({value:"marks_both"},"Crop and Bleed")),ze&&o.classList.add(G("hidden-select"));var h=Ce(o),f=Ce(c),g=k("span","Loading"),m=void 0,v=_e("→",{style:{display:"none"},onclick:function(){window.binderyDebug.step(),document.scrollingElement.scrollTop=document.scrollingElement.scrollHeight}}),b=_e("❙❙",{onclick:function(){window.binderyDebug.pause(),a.classList.add(G("paused")),b.style.display="none",m.style.display="",v.style.display=""}});m=_e("▶️",{style:{display:"none"},onclick:function(){window.binderyDebug.resume(),a.classList.remove(G("paused")),m.style.display="none",b.style.display="",v.style.display="none"}});var y=_e("Finish",{onclick:function(){a.classList.remove(G("paused")),window.binderyDebug.finish()}}),w=k(G(".debug-controls"),b,m,v,y);a=k(G(".spinner"));var x=k(G(".progress-bar")),C=Se(g);this.setInProgress=function(){g.textContent="Paginating"};var _=0;this.updateProgress=function(e,t){var n=performance.now();n-_>100&&(_=n,x.style.width=100*t+"%",g.textContent=e+" Pages")},this.setDone=function(){x.style.width="100%",g.textContent=r.book.pages.length+" Pages"},this.setInvalid=function(){},s.classList.add(G("btn-print"));var P=Ce(p,f,h);P.classList.add(G("print-options"));i=Le({onchange:function(e){var t=e.target.value;"view_grid"===t?r.setGrid():"view_flip"===t?r.setFlip():"view_print"===t&&r.setPrint()}},Ee({value:"view_grid"},"Preview"),Ee({value:"view_flip"},"Flipbook"),Ee({value:"view_print"},"Print Preview"));var L=Ce(i);L.classList.add(G("view-row")),this.element=k(G(".controls"),x,C,w,L,P,s)},Te=function(e,t){return k(G(".error"),k(G(".error-title"),e),k(G(".error-text"),t),k(G(".error-footer"),"Bindery "+p))},Oe=function(e,t){for(;e.length%4!=0;){var n=t();n.element.style.visibility="hidden",e.push(n)}for(var r=[],i=e.length,o=0;o<i/2;o+=2)r.push(e[i-1-o]),r.push(e[o]),r.push(e[o+1]),r.push(e[i-2-o]);return r},Be=function(e,t){if(e.length%2!=0){var n=t();e.push(n)}var r=t(),i=t();return r.element.style.visibility="hidden",i.element.style.visibility="hidden",e.unshift(r),e.push(i),e},Ne=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,[G(".spread-wrapper")+G(".spread-size")].concat(t))},Re=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,[G(".spread-wrapper")+G(".page-size")].concat(t))},Me=function(e,t){var n=document.createDocumentFragment();if(t)for(var r=0;r<e.length;r+=2){var i=Ne(e[r].element,e[r+1].element);n.appendChild(i)}else e.forEach(function(e){var t=Re(e.element);n.appendChild(t)});return n},je=function(){return[k(G(".bleed-top")),k(G(".bleed-bottom")),k(G(".bleed-left")),k(G(".bleed-right"))]},Fe=function(){return[k(G(".crop-top")),k(G(".crop-bottom")),k(G(".crop-left")),k(G(".crop-right"))]},Ie=function(){return k.apply(void 0,[G(".print-mark-wrap")].concat(E(Fe()),E(je())))},He=function(){return k.apply(void 0,[G(".print-mark-wrap"),k(G(".crop-fold"))].concat(E(Fe()),E(je())))},De=function(e,t){var n=e%4==0,r=parseInt((e+1)/4,10)+1;return k(G(".print-meta"),"Sheet "+r+" of "+t/4+": "+(n?"Outside":"Inside"))},Ge=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,[G(".spread-wrapper")+G(".spread-size")].concat(t))},qe=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,[G(".spread-wrapper")+G(".page-size")].concat(t))},Ve=function(e,t,n){var r=document.createDocumentFragment(),i=t?He:Ie,o=t?Ge:qe,a=function(){return k(G(".print-page"),o.apply(void 0,arguments))};if(t)for(var s=0;s<e.length;s+=2){var l=i();if(n){var u=De(s,e.length);l.appendChild(u)}var c=a(e[s].element,e[s+1].element,l);r.appendChild(c)}else e.forEach(function(e){var t=a(e.element,i());r.appendChild(t)});return r},Ue=function(e,t){var n=document.createDocumentFragment(),r=k(G(".spread-size")+G(".flip-sizer")),i=k(G(".spread-size")+G(".flap-holder"));r.appendChild(i),n.appendChild(r);var o=[],a=-1,s=4;e.length*s>60&&(s=60/e.length),i.style.width=e.length*s+"px";for(var l=function(e){var t=e;t===a&&(t+=1),a=t;var n=4;o.length*n>200&&(n=200/o.length),o.forEach(function(e,r,i){var o=(i.length-Math.abs(r-t+.5))*n;e.style.transform="translate3d("+(r<t?4:0)+"px,0,"+o+"px) rotateY("+(r<t?-180:0)+"deg)"})},u=0,c=1;c<e.length-1;c+=t?2:1)!function(n){var r=u+=1,a=k(G(".page3d")+G(".page-size"),{onclick:function(){l(r-1)}}),c=e[n].element,d=void 0;c.classList.add(G("page3d-front")),a.appendChild(c),t?(a.classList.add(G("doubleSided")),(d=e[n+1].element).classList.add(G("page3d-back")),a.appendChild(d)):(d=k(G(".page")+G(".page3d-back")),a.appendChild(d)),a.style.left=n*s+"px",o.push(a),i.appendChild(a)}(c);return l(0),n},We="grid",Ye="arrange_one",Ze=function(){function e(t){var n=t.bindery;S(this,e),this.book=null,this.pageSetup=n.pageSetup,this.zoomBox=k(G(".zoom-wrap")),this.element=k(G(".root"),this.zoomBox),this.doubleSided=!0,this.printArrange=Ye,this.isShowingCropMarks=!0,this.isShowingBleedMarks=!1,this.mode=We,this.element.setAttribute("bindery-view-mode",this.mode),this.currentLeaf=0,this.listenForPrint(),this.listenForResize(),this.setGrid=this.setGrid.bind(this),this.setPrint=this.setPrint.bind(this),this.setFlip=this.setFlip.bind(this),this.controls=new Ae({binder:n,viewer:this}),this.element.classList.add(G("in-progress")),this.element.appendChild(this.controls.element),document.body.appendChild(this.element)}return C(e,[{key:"listenForPrint",value:function(){var e=this;window.matchMedia&&window.matchMedia("print").addListener(function(t){t.matches&&e.setPrint()}),document.body.addEventListener("keydown",function(t){(t.ctrlKey||t.metaKey)&&80===t.keyCode&&(t.preventDefault(),e.setPrint(),setTimeout(function(){window.print()},10))})}},{key:"listenForResize",value:function(){var e=this;window.addEventListener("resize",function(){e.throttleResize||(e.updateZoom(),e.throttleResize=setTimeout(function(){e.throttleResize=null},20))})}},{key:"setInProgress",value:function(){this.element.classList.add(G("in-progress")),this.controls.setInProgress()}},{key:"setSheetSize",value:function(e){var t=this;this.pageSetup.setSheetSizeMode(e),this.pageSetup.updateStylesheet(),"print"!==this.mode&&this.setPrint(),this.updateZoom(),setTimeout(function(){t.updateZoom()},300)}},{key:"setPrintArrange",value:function(e){e!==this.printArrange&&(this.printArrange=e,this.pageSetup.setPrintTwoUp(this.isTwoUp),this.pageSetup.updateStylesheet(),"print"===this.mode?this.render():this.setPrint())}},{key:"displayError",value:function(e,t){this.element.parentNode||document.body.appendChild(this.element),this.error||(this.error=Te(e,t),this.element.appendChild(this.error))}},{key:"clear",value:function(){this.book=null,this.lastSpreadInProgress=null,this.zoomBox.innerHTML=""}},{key:"cancel",value:function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)}},{key:"toggleBleed",value:function(){this.element.classList.add(G("show-bleed"))}},{key:"toggleDouble",value:function(){this.doubleSided=!this.doubleSided,this.render()}},{key:"setMode",value:function(e){switch(e){case"grid":case"default":this.mode=We;break;case"interactive":case"flip":this.mode="interactive";break;case"print":case"sheet":this.mode="print";break;default:console.error('Bindery: Unknown view mode "'+e+'"')}}},{key:"setGrid",value:function(){this.mode!==We&&(this.mode=We,this.render())}},{key:"setPrint",value:function(){"print"!==this.mode&&(this.mode="print",this.render())}},{key:"setFlip",value:function(){this.mode="interactive",this.render()}},{key:"render",value:function(){var e=this;if(this.book){var t=document.body;this.element.parentNode||t.appendChild(this.element),this.flaps=[],t.classList.add(G("viewing")),this.element.setAttribute("bindery-view-mode",this.mode);var n=t.scrollHeight-t.offsetHeight,r=t.scrollTop/n;this.controls.setDone(),window.requestAnimationFrame(function(){e.mode===We?e.renderGrid():"interactive"===e.mode?e.renderInteractive():"print"===e.mode?e.renderPrint():e.renderGrid(),t.scrollTop=n*r,e.updateZoom()})}}},{key:"renderProgress",value:function(e){var t=this;this.book=e,this.controls.updateProgress(this.book.pages.length,this.book.estimatedProgress);var n=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,[G(".spread-wrapper")+G(".spread-size")].concat(t))};this.book.pages.forEach(function(e,r){if(!t.zoomBox.contains(e.element)||e.element.parentNode===t.zoomBox)if(t.lastSpreadInProgress&&t.lastSpreadInProgress.children.length<2)t.lastSpreadInProgress.appendChild(e.element);else{if(0===r){var i=new q;i.element.style.visibility="hidden",t.lastSpreadInProgress=n(i.element,e.element)}else t.lastSpreadInProgress=n(e.element);t.zoomBox.appendChild(t.lastSpreadInProgress)}}),this.book.pageInProgress&&this.zoomBox.appendChild(this.book.pageInProgress.element),this.updateZoom()}},{key:"updateZoom",value:function(){if(this.zoomBox.firstElementChild){var e=document.body.scrollTop/document.body.scrollHeight,t=this.zoomBox.getBoundingClientRect(),n=this.zoomBox.firstElementChild.getBoundingClientRect().width,r=Math.min(1,t.width/n);this.zoomBox.style.transform="scale("+r+")",document.body.scrollTop=document.body.scrollHeight*e}}},{key:"renderPrint",value:function(){this.element.classList.add(G("show-bleed")),this.zoomBox.innerHTML="";var e="arrange_booklet"===this.printArrange,t=this.book.pages.slice();"arrange_two"===this.printArrange?t=Be(t,function(){return new q}):e&&(t=Oe(t,function(){return new q}));var n=Ve(t,this.isTwoUp,e);this.zoomBox.appendChild(n)}},{key:"renderGrid",value:function(){this.zoomBox.innerHTML="",this.element.classList.remove(G("show-bleed"));var e=this.book.pages.slice();this.doubleSided&&(e=Be(e,function(){return new q}));var t=Me(e,this.doubleSided);this.zoomBox.appendChild(t)}},{key:"renderInteractive",value:function(){this.zoomBox.innerHTML="",this.flaps=[],this.element.classList.remove(G("show-bleed"));var e=Be(this.book.pages.slice(),function(){return new q}),t=Ue(e,this.doubleSided);this.zoomBox.appendChild(t)}},{key:"isTwoUp",get:function(){return this.printArrange!==Ye}},{key:"isShowingCropMarks",get:function(){return this.element.classList.contains(G("show-crop"))},set:function(e){e?(this.element.classList.add(G("show-crop")),this.setPrint()):this.element.classList.remove(G("show-crop"))}},{key:"isShowingBleedMarks",get:function(){return this.element.classList.contains(G("show-bleed-marks"))},set:function(e){e?(this.element.classList.add(G("show-bleed-marks")),this.setPrint()):this.element.classList.remove(G("show-bleed-marks"))}}]),e}(),Ke=function(e){function t(e){S(this,t),e.toNext=e.toNext||"split-to-next",e.fromPrevious=e.fromPrevious||"split-from-previous";var n=L(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return F.validate(e,{name:"Split",selector:F.string,toNext:F.string,fromPrevious:F.string}),n}return P(t,K),C(t,[{key:"customToNextClass",get:function(){return this.toNext}},{key:"customFromPreviousClass",get:function(){return this.fromPrevious}}]),t}(),Je=function(e){function t(e){S(this,t);var n=L(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.selector="*",n.counterValue=0,F.validate(e,{name:"Counter",replaceEl:F.string,resetEl:F.string,incrementEl:F.string,replace:F.func}),n}return P(t,K),C(t,[{key:"setup",value:function(){this.counterValue=0}},{key:"beforeAdd",value:function(e){return e.matches(this.incrementEl)&&(this.counterValue+=1),e.matches(this.resetEl)&&(this.counterValue=0),e.matches(this.replaceEl)?this.createReplacement(e):e}},{key:"createReplacement",value:function(e){return this.replace(e,this.counterValue)}},{key:"replace",value:function(e,t){return e.textContent=t,e}}]),t}(),$e=function(e){function t(e){S(this,t);var n=L(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name="Replace",n}return P(t,K),C(t,[{key:"afterAdd",value:function(e,t,n,r,i){var o=e.parentNode;if(!o)throw Error("Bindery: Rule assumes element has been added but it has no parent.",e);var a=e.cloneNode(!0),s=this.createReplacement(t,a);return o.replaceChild(s,e),t.pageInProgress.hasOverflowed()?(o.replaceChild(e,s),i(e)):s}},{key:"createReplacement",value:function(e,t){return this.replace(t)}},{key:"replace",value:function(e){return e.insertAdjacentHTML("beforeEnd",'<sup class="bindery-sup">Default Replacement</sup>'),e}}]),t}(),Xe=function(e){function t(e){S(this,t);var n=L(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return F.validate(e,{name:"Footnote",selector:F.string,replace:F.func,render:F.func}),n}return P(t,$e),C(t,[{key:"afterAdd",value:function(e,n,r,i,o){var a=n.pageInProgress.footer.children.length+1,s=k(".footnote"),l=this.render(e,a);return l instanceof HTMLElement?s.appendChild(l):s.innerHTML=l,n.pageInProgress.footer.appendChild(s),_(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"afterAdd",this).call(this,e,n,r,i,function(e){return n.pageInProgress.footer.removeChild(s),o(e)})}},{key:"createReplacement",value:function(e,t){var n=e.pageInProgress.footer.children.length;return this.replace(t,n)}},{key:"replace",value:function(e,t){return e.insertAdjacentHTML("beforeEnd",'<sup class="bindery-sup">'+t+"</sup>"),e}},{key:"render",value:function(e,t){return"<sup>"+t+"</sup> Default footnote (<a href='/bindery/docs/#footnote'>Learn how to change it</a>)"}}]),t}(),Qe=function(e){function t(e){S(this,t);var n=L(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return F.validate(e,{name:"PageReference",selector:F.string,replace:F.func,createTest:F.func}),n}return P(t,$e),C(t,[{key:"afterAdd",value:function(e,t){var n=this,r=this.createTest(e);if(r){var i=e.parentNode,o=e.cloneNode(!0),a=t.pagesForTest(r),s=T(a),l=this.replace(o,s||"###");return l.classList.add(G("placeholder-pulse")),i.replaceChild(l,e),t.onComplete(function(){var i=l.parentNode,o=e.cloneNode(!0),a=t.pagesForTest(r),s=T(a),u=n.replace(o,s);i.replaceChild(u,l)}),l}return e}},{key:"createTest",value:function(e){var t=e.getAttribute("href");return t?(t=t.replace("#",""),t='[id="'+t+'"]',function(e){return e.querySelector(t)}):null}},{key:"replace",value:function(e,t){return e.insertAdjacentHTML("beforeend",", <span>"+t+"</span>"),e}}]),t}(),et=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};S(this,t);var n=L(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return F.validate(e,{name:"RunningHeader",render:F.func}),n}return P(t,K),C(t,[{key:"eachPage",value:function(e){if(!e.runningHeader){var t=k(G(".running-header"));e.element.appendChild(t),e.runningHeader=t}e.runningHeader.innerHTML=this.render(e)}},{key:"render",value:function(e){return e.number}}]),t}(),tt={Rule:K,Split:function(e){return new Ke(e)},Counter:function(e){return new Je(e)},FullBleedPage:function(e){return new $(e)},Footnote:function(e){return new Xe(e)},RunningHeader:function(e){return new et(e)},Replace:function(e){return new $e(e)},FullBleedSpread:function(e){return new X(e)},PageBreak:function(e){return new Q(e)},PageReference:function(e){return new Qe(e)},createRule:function(e){return new K(e)}},nt=tt.PageBreak,rt=tt.PageReference,it=tt.Footnote,ot=tt.FullBleedPage,at=tt.FullBleedSpread,st=function(e,t){return e.textContent=""+t,e},lt=[nt({selector:'[book-page-break="both"]',position:"both"}),nt({selector:'[book-page-break="avoid"]',position:"avoid"}),nt({selector:'[book-page-break="after"][book-page-continue="right"]',position:"after",continue:"right"}),nt({selector:'[book-page-break="after"][book-page-continue="left"]',position:"after",continue:"left"}),nt({selector:'[book-page-break="after"][book-page-continue="next"]',position:"after",continue:"next"}),nt({selector:'[book-page-break="before"][book-page-continue="right"]',position:"before",continue:"right"}),nt({selector:'[book-page-break="before"][book-page-continue="left"]',position:"before",continue:"left"}),nt({selector:'[book-page-break="before"][book-page-continue="next"]',position:"before",continue:"next"}),ot({selector:'[book-full-bleed="page"]'}),at({selector:'[book-full-bleed="spread"]'}),it({selector:"[book-footnote-text]",render:function(e,t){return"<i>"+t+"</i>"+e.getAttribute("book-footnote-text")}}),rt({selector:"[book-pages-with-text]",replace:st,createTest:function(e){var t=e.getAttribute("book-pages-with-text").toLowerCase().trim();return function(e){return e.textContent.toLowerCase().includes(t)}}}),rt({selector:"[book-pages-with-selector]",replace:st,createTest:function(e){var t=e.getAttribute("book-pages-with-selector").trim();return function(e){return e.querySelector(t)}}}),rt({selector:"[book-pages-with]",replace:st,createTest:function(e){var t=e.textContent.toLowerCase().trim();return function(e){return e.textContent.toLowerCase().includes(t)}}})];!function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t)}}("@charset \"UTF-8\";@media screen{.📖-page{background:#fff;outline:1px solid #ddd;box-shadow:0 2px 4px -1px rgba(0,0,0,.15);overflow:hidden}.📖-show-bleed .📖-page{box-shadow:none;outline:none;overflow:visible}.📖-page:after{content:\"\";position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:3}}li.📖-continuation,p.📖-continuation{text-indent:unset!important}li.📖-continuation{list-style:none!important}.📖-out-of-flow{display:none}.📖-page{width:200px;height:300px;position:relative;display:flex;flex-direction:column;flex-wrap:nowrap;margin:auto}.📖-flowbox{position:relative;margin:60px 40px;margin-bottom:0;flex:1 1 auto;min-height:0}.📖-content{padding:.1px;position:relative}.📖-footer{margin:60px 40px;margin-top:8pt;flex:0 1 auto;z-index:1}.📖-background{position:absolute;z-index:0;overflow:hidden}.📖-left>.📖-background{right:0}.📖-right>.📖-background{left:0}.📖-sup{font-size:.667em}.📖-footer,.📖-running-header{font-size:10pt}.📖-running-header{position:absolute;text-align:center;top:.25in}.📖-left .📖-running-header{left:18pt;text-align:left}.📖-right .📖-running-header{right:18pt;text-align:right}.📖-left .📖-rotate-container.📖-rotate-outward,.📖-left .📖-rotate-container.📖-rotate-spread-clockwise,.📖-right .📖-rotate-container.📖-rotate-inward,.📖-rotate-container.📖-rotate-clockwise{transform:rotate(90deg) translate3d(0,-100%,0);transform-origin:top left}.📖-left .📖-rotate-container.📖-rotate-inward,.📖-left .📖-rotate-container.📖-rotate-spread-counterclockwise,.📖-right .📖-rotate-container.📖-rotate-outward,.📖-rotate-container.📖-rotate-counterclockwise{transform:rotate(-90deg) translate3d(-100%,0,0);transform-origin:top left}.📖-rotate-container{position:absolute}.📖-left .📖-rotate-container.📖-rotate-clockwise .📖-background{bottom:0}.📖-left .📖-rotate-container.📖-rotate-counterclockwise .📖-background,.📖-right .📖-rotate-container.📖-rotate-clockwise .📖-background{top:0}.📖-right .📖-rotate-container.📖-rotate-counterclockwise .📖-background,.📖-rotate-container.📖-rotate-inward .📖-background{bottom:0}.📖-rotate-container.📖-rotate-outward .📖-background{top:0}.📖-right .📖-rotate-container.📖-rotate-spread-clockwise{transform:rotate(90deg) translate3d(0,-50%,0);transform-origin:top left}.📖-right .📖-rotate-container.📖-rotate-spread-counterclockwise{transform:rotate(-90deg) translate3d(-100%,-50%,0);transform-origin:top left}@media screen{.📖-viewing{background:#f4f4f4!important}.📖-root{transition:opacity .2s;opacity:1;padding:10px;position:relative;padding-top:60px;min-height:90vh}.📖-measure-area,.📖-root{background:#f4f4f4;z-index:2}.📖-measure-area{position:fixed;padding:50px 20px;visibility:hidden;left:0;right:0;bottom:0}.📖-measure-area .📖-page{margin:0 auto 50px}.📖-is-overflowing{border-bottom:1px solid #f0f}.📖-print-page{margin:0 auto}.📖-error{font:16px/1.4 -apple-system,BlinkMacSystemFont,Roboto,sans-serif;padding:15vh 15vw;z-index:3;position:fixed;top:0;left:0;right:0;bottom:0;background:hsla(0,0%,96%,.7)}.📖-error-title{font-size:1.5em;margin-bottom:16px}.📖-error-text{margin-bottom:16px;white-space:pre-line}.📖-error-footer{opacity:.5;font-size:.66em;text-transform:uppercase;letter-spacing:.02em}.📖-show-bleed .📖-print-page{background:#fff;outline:1px solid rgba(0,0,0,.1);box-shadow:0 1px 3px rgba(0,0,0,.2);margin:20px auto}.📖-placeholder-pulse{animation:a 1s infinite}}@keyframes a{0%{opacity:.2}50%{opacity:.5}to{opacity:.2}}@page{margin:0}@media print{.📖-root *{-webkit-print-color-adjust:exact;color-adjust:exact}.📖-controls,.📖-viewing>:not(.📖-root){display:none!important}.📖-print-page{padding:1px;margin:0 auto}.📖-zoom-wrap[style]{transform:none!important}}body.📖-viewing{margin:0}.📖-zoom-wrap{transform-origin:top left;transform-style:preserve-3d;height:calc(100vh - 120px)}[bindery-view-mode=interactive] .📖-zoom-wrap{transform-origin:center left}.📖-viewing>:not(.📖-root):not(.📖-measure-area){display:none!important}.📖-print-page{page-break-after:always;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center;transition:all .2s}.📖-spread-wrapper{position:relative;display:flex;width:800px;margin:0 auto 32px}.📖-print-page .📖-spread-wrapper{margin:0 auto}.📖-flap-holder{perspective:5000px;position:absolute;top:0;right:0;left:0;bottom:0;margin:auto;transform-style:preserve-3d}.📖-flip-sizer{position:relative;margin:auto;padding:0 20px;box-sizing:content-box;height:100%!important}.📖-page3d{margin:auto;width:400px;height:600px;transform:rotateY(0);transform-style:preserve-3d;transform-origin:left;transition:transform .5s,box-shadow .1s;position:absolute;left:0;right:0;top:0;bottom:0}.📖-page3d:hover{box-shadow:2px 0 4px rgba(0,0,0,.2)}.📖-page3d.flipped{transform:rotateY(-180deg)}.📖-page3d .📖-page{position:absolute;backface-visibility:hidden;-webkit-backface-visibility:hidden;box-shadow:none}.📖-page3d .📖-page3d-front{transform:rotateY(0)}.📖-page3d .📖-page3d-back{transform:rotateY(-180deg)}.📖-print-mark-wrap{display:none;position:absolute;pointer-events:none;top:0;bottom:0;left:0;right:0;z-index:3}.📖-show-bleed-marks .📖-print-mark-wrap,.📖-show-bleed-marks .📖-print-mark-wrap>[class*=bleed],.📖-show-crop .📖-print-mark-wrap,.📖-show-crop .📖-print-mark-wrap>[class*=crop]{display:block}.📖-print-mark-wrap>div{display:none;position:absolute;overflow:hidden}.📖-print-mark-wrap>div:after,.📖-print-mark-wrap>div:before{content:\"\";display:block;position:absolute}.📖-print-mark-wrap>div:before{top:0;left:0}.📖-print-mark-wrap>div:after{bottom:0;right:0}.📖-bleed-left,.📖-bleed-right,.📖-crop-fold,.📖-crop-left,.📖-crop-right{width:1px;margin:auto}.📖-bleed-left:after,.📖-bleed-left:before,.📖-bleed-right:after,.📖-bleed-right:before,.📖-crop-fold:after,.📖-crop-fold:before,.📖-crop-left:after,.📖-crop-left:before,.📖-crop-right:after,.📖-crop-right:before{width:1px;height:12pt;background-image:linear-gradient(90deg,#000 0,#000 51%,transparent 0);background-size:1px 100%}.📖-bleed-bottom,.📖-bleed-top,.📖-crop-bottom,.📖-crop-top{height:1px}.📖-bleed-bottom:after,.📖-bleed-bottom:before,.📖-bleed-top:after,.📖-bleed-top:before,.📖-crop-bottom:after,.📖-crop-bottom:before,.📖-crop-top:after,.📖-crop-top:before{width:12pt;height:1px;background-image:linear-gradient(180deg,#000 0,#000 51%,transparent 0);background-size:100% 1px}.📖-crop-fold{right:0;left:0}.📖-crop-left{left:0}.📖-crop-right{right:0}.📖-crop-top{top:0}.📖-crop-bottom{bottom:0}.📖-print-meta{padding:12pt;text-align:center;font-family:-apple-system,BlinkMacSystemFont,Roboto,sans-serif;font-size:8pt;display:block!important;position:absolute;bottom:-60pt;left:0;right:0}@media screen{.📖-viewing .📖-controls{display:flex!important}}.📖-controls{font:16px/1.4 -apple-system,BlinkMacSystemFont,Roboto,sans-serif;display:none;flex-direction:row;align-items:start;position:fixed;top:0;left:0;right:0;z-index:3;margin:auto;color:#000;padding:10px;overflow:visible;-webkit-font-smoothing:antialiased}.📖-controls *{font:inherit;color:inherit;margin:0;padding:0;box-sizing:border-box}.📖-controls a{color:#0000c5;text-decoration:none}.📖-row{flex-wrap:wrap;align-items:start;cursor:default;user-select:none}.📖-row,.📖-title{position:relative;display:flex}.📖-title{padding:8px 16px;transition:opacity .2s;white-space:nowrap;overflow:hidden;margin-right:auto}.📖-print-options{display:flex;opacity:0;max-width:0;border-radius:0;background:#e4e4e4;overflow:hidden;transition:all .4s;flex-wrap:nowrap;transition-delay:.2s}[bindery-view-mode=print] .📖-print-options{max-width:720px;margin-right:12px;opacity:1}.📖-in-progress .📖-print-options{opacity:0;display:none}.📖-controls .📖-print-options .📖-control{background-color:transparent}.📖-spinner{border:1px solid transparent;border-left-color:#000;width:20px;height:20px;border-radius:50%;vertical-align:middle;opacity:0;pointer-events:none;transition:all .2s;margin-right:16px}.📖-in-progress .📖-spinner{opacity:1;animation:b .6s linear infinite}.📖-debug .📖-spinner{animation:b 2s linear infinite}.📖-spinner.📖-paused{animation:none}@keyframes b{0%{transform:rotate(0)}to{transform:rotate(1turn)}}.📖-controls .📖-btn{-webkit-appearance:none;cursor:pointer;display:inline-block;margin-right:8px;text-decoration:none}.📖-controls .📖-btn:hover{background:#ddd}.📖-controls .📖-btn:active{background:#eee}.📖-controls .📖-btn:last-child{margin-right:0}.📖-controls .📖-control{border-radius:0;color:#000;padding:8px 16px;background-color:#f4f4f4;border:0}.📖-controls .📖-btn-light{background:none;border:none}.📖-controls .📖-btn-main{background:#0000c5;border-color:#0000c5;color:#fff}.📖-controls .📖-btn-main:hover{background:#0000c5;opacity:.7}.📖-controls .📖-btn-main:active{background:#000;opacity:1}.📖-view-row{margin-left:auto;margin-right:12px;transition:all .5s}.📖-in-progress .📖-view-row{opacity:0;pointer-events:none}.📖-debug .📖-view-row{display:none}.📖-btn-print{transition:all .5s}.📖-in-progress .📖-btn-print{opacity:0;pointer-events:none}.📖-debug .📖-btn-print{display:none}.📖-controls .📖-select-wrap{padding-right:32px;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='32' height='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 14l5 5 5-5' stroke='%23000' fill='none'/%3E%3C/svg%3E\");background-repeat:no-repeat;background-position:100%;transition:all .2s;white-space:nowrap;width:100%}.📖-controls .📖-select-wrap:active,.📖-controls .📖-select-wrap:hover{background-color:#ddd}.📖-controls .📖-select-wrap.📖-hidden-select{max-width:0;padding-left:0;padding-right:0;border-left-width:0;border-right-width:0;color:transparent}.📖-select{position:absolute;top:0;left:0;opacity:0;-webkit-appearance:none;-moz-appearance:none;padding:8px 16px;color:#000;border:transparent;width:100%}.📖-debug-controls{display:none}.📖-debug .📖-in-progress .📖-debug-controls{display:block}.📖-refresh-btns{opacity:0;position:absolute;top:0;left:0;padding:8px 0;transition:all .2s}.📖-in-progress .📖-refresh-btns{display:none}.📖-refresh-btns a{margin-left:1em;cursor:pointer}.📖-refresh-btns a:hover{color:#000}.📖-progress-bar{position:absolute;left:0;top:0;background:#0000c5;width:0;transition:all .2s;opacity:0;height:0}.📖-in-progress .📖-progress-bar{opacity:1;height:2px}@media screen and (max-width:720px){.📖-print-options{max-width:unset;max-height:0}[bindery-view-mode=print] .📖-print-options{max-width:unset;max-height:240px;margin:0}.📖-root{transition:all .2s}[bindery-view-mode=print].📖-root{padding-top:120px}.📖-controls{height:98px}.📖-view-row{margin-left:auto}.📖-print-options{top:54px;right:10px;position:fixed;margin:0}.📖-print-options .📖-row{margin:0}}@media screen and (max-width:500px){[bindery-view-mode=print].📖-root{padding-top:190px}[bindery-view-mode=print].📖-root .📖-controls{background:#f4f4f4;height:170px}.📖-print-options{flex-direction:column;align-items:stretch;left:10px}.📖-hidden-select{display:none}}");var ut=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(S(this,e),console.log("📖 Bindery "+p),this.autorun=t.autorun||!0,this.autoupdate=t.autoupdate||!1,U.isDebugging=t.debug||I("debug")||!1,F.validate(t,{name:"makeBook",autorun:F.bool,content:F.any,pageSetup:F.shape({name:"pageSetup",bleed:F.length,margin:F.shape({name:"margin",top:F.length,inner:F.length,outer:F.length,bottom:F.length}),size:F.shape({name:"size",width:F.length,height:F.length})}),rules:F.array}),this.pageSetup=new xe(t.pageSetup),this.viewer=new Ze({bindery:this}),t.startingView&&this.viewer.setMode(t.startingView),this.rules=lt,t.rules&&this.addRules(t.rules),t.content)if("string"==typeof t.content){if(this.source=document.querySelector(t.content),!(this.source instanceof HTMLElement))return this.viewer.displayError("Content not specified",'Could not find element that matches selector "'+t.content+'"'),void console.error('Bindery: Could not find element that matches selector "'+t.content+'"');this.autorun&&this.makeBook()}else if("object"===x(t.content)&&t.content.url){var n=t.content.url,r=t.content.selector;this.fetchSource(n,r)}else t.content instanceof HTMLElement?(this.source=t.content,this.autorun&&this.makeBook()):console.error("Bindery: Source must be an element or selector");else this.viewer.displayError("Content not specified","You must include a source element, selector, or url"),console.error("Bindery: You must include a source element or selector")}return C(e,[{key:"fetchSource",value:function(e,t){var n=this;fetch(e).then(function(t){if(404===t.status)n.viewer.displayError("404",'Could not find file at "'+e+'"');else if(200===t.status)return t.text();return""}).then(function(e){var r=k("div");if(r.innerHTML=e,n.source=r.querySelector(t),!(n.source instanceof HTMLElement))return n.viewer.displayError("Source not specified",'Could not find element that matches selector "'+t+'"'),void console.error('Bindery: Could not find element that matches selector "'+t+'"');n.autorun&&n.makeBook()}).catch(function(t){console.error(t),"file"===window.location.href.split("://")[0]&&n.viewer.displayError("Can't fetch content from \""+e+'"',"Web pages can't fetch content unless they are on a server.")})}},{key:"cancel",value:function(){this.viewer.cancel(),document.body.classList.remove(G("viewing")),this.source.style.display=""}},{key:"addRules",value:function(e){var t=this;e.forEach(function(e){if(!(e instanceof tt.Rule))throw Error("Bindery: The following is not an instance of Bindery.Rule and will be ignored: "+e);t.rules.push(e)})}},{key:"updateBookSilent",value:function(){var e=this;this.layoutComplete=!1,this.source.style.display="";var t=this.source.cloneNode(!0);this.source.style.display="none",document.body.classList.add(G("viewing")),this.pageSetup.updateStylesheet(),ve({content:t,rules:this.rules,success:function(t){e.viewer.book=t,e.viewer.render(),e.layoutComplete=!0},progress:function(){},error:function(t){e.layoutComplete=!0,e.viewer.displayError("Layout failed",t)}})}},{key:"makeBook",value:function(e){var t=this;if(this.source){if(this.layoutComplete=!1,!this.pageSetup.isSizeValid())return this.viewer.displayError("Page is too small","Size: "+JSON.stringify(this.pageSize)+" \n Margin: "+JSON.stringify(this.pageMargin)+" \n Try adjusting the sizes or units."),void console.error("Bindery: Cancelled pagination. Page is too small.");this.source.style.display="";var n=this.source.cloneNode(!0);this.source.style.display="none",this.viewer.clear(),document.body.classList.add(G("viewing")),U.isDebugging&&document.body.classList.add(G("debug")),this.pageSetup.updateStylesheet(),this.viewer.setInProgress(),ve(n,this.rules).progress(function(e){t.viewer.renderProgress(e)}).then(function(n){t.viewer.book=n,t.viewer.render(),t.layoutComplete=!0,e&&e(),t.viewer.element.classList.remove(G("in-progress")),document.body.classList.remove(G("debug"))}).catch(function(e){t.layoutComplete=!0,t.viewer.element.classList.remove(G("in-progress")),t.viewer.displayError("Layout couldn't complete",e)})}else document.body.classList.add(G("viewing"))}}],[{key:"makeBook",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.autorun=!t.autorun||t.autorun,new e(t)}}]),e}();return ut.version=p,Object.assign(ut,tt)}();
//# sourceMappingURL=bindery.min.js.map
